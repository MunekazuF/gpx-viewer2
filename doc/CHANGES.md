# 変更履歴

## v1.1.5 - 2025-08-07

### 機能追加
- ファイル編集ダイアログに削除ボタンを追加
- ファイル一覧のチェックボックスを全てONにする機能を追加

### 不具合修正
- ファイル編集ダイアログからのGPXファイル削除時に`deleteSelectedGpx`が未定義となる問題を修正

### 削除
- ファイル一覧下部の削除ボタンを削除


## v1.1.4 - 2025-08-07

### 機能追加
- GPXファイル編集機能を追加
  - ファイル一覧の各項目にケバブメニュー（縦三点リーダー）ボタンを追加
  - ケバブメニューからファイル名と軌跡の色を編集できるモーダルダイアログを表示
  - 編集ダイアログにリセットボタンを追加し、GPXファイルから取得した元のファイル名と色に戻せるようにした

### 不具合修正
- 編集後の軌跡の色が地図に反映されない問題を修正
  - `Map.js`の`Polyline`コンポーネントの`key`プロパティに`gpx.color`を追加し、色変更時に強制的に再描画されるようにした
- 編集画面で軌跡の色が初期表示時に黒になる問題を修正
  - `GpxContext.js`で色を生成する際に`hsl`形式で生成し、`EditGpxModal.js`で表示時に`hsl`から`hex`に変換、保存時に`hex`から`hsl`に変換するように修正
  - 既存のGPXデータに`originalName`や`color`がなかった場合、初回ロード時に`IndexedDB`に保存するように修正


## v1.1.3 - 2025-08-07

### 不具合修正
- サイドバー開閉時の地図表示崩れと初期表示時のタイル欠けを修正
  - サイドバーの開閉時に地図が正しく再描画されない問題を解決するため、`App.js`でサイドバーの状態変更を検知し、地図インスタンスの`invalidateSize()`を遅延実行するように変更しました。これにより、`Split.js`のアニメーション完了後に地図が適切にリサイズされます。
  - 地図の初期表示時にタイルが完全に読み込まれない問題を解決するため、`Map.js`内でローカルなref (`mapLocalRef`) を使用し、コンポーネントのマウント時に`invalidateSize()`を遅延実行するようにしました。
  - これらの変更により、地図の初期描画と動的なサイズ変更の責務を分離し、より安定した表示を実現しました。



## v1.1.2 - 2025-08-06

### リファクタリング
- `src`ディレクトリ内のコンポーネントとスタイルシートを`src/components`に整理
- `ElevationGraph.js`のインラインスタイルを`ElevationGraph.css`に分離
- TODOリストに基づき、以下のリファクタリングを実施
  - `useGpx.js`を`Context API`に置き換え（ステップ1）
  - `App.js`のUIロジックを`useUI.js`カスタムフックに分離（ステップ2）
  - `Map.js`内のコンポーネントを個別のファイルに分割（ステップ3）

## v1.1.1 - 2025-08-06

### 機能改善
- 標高グラフにマージモードを追加
  - 複数のGPXデータを開始日が古い順に結合し、1本のグラフとして表示
  - マージモードで「獲得標高」を選択した場合、合計獲得標高をグラフコントロールボタンの右に表示

## v1.0.3 - 2025-08-06

### 機能改善
- ワイドスクリーン時のサイドバー折りたたみ・展開機能を追加
  - サイドバーに折りたたみボタン（`<`）を、地図エリアに展開ボタン（`>`）を設置
- タブレット（幅769px〜1366px）でのサイドバー初期幅を30%に調整
- グラフエリアのサイズ変更時にサイドバーが意図せず表示される問題を修正
  - `Split.js`の初期化ロジックを分離し、グラフのサイズ変更がサイドバーの状態に影響しないように改善
- iPadでの表示崩れを解消するため、高さの単位を`vh`から`dvh`に変更

## v1.0.2 - 2025-08-05

### 機能改善
- 標高グラフのポップアップ表示内容を改善
  - ポップアップにグラフの線の色を示す四角、ファイル名、年月日時刻、標高（小数点以下四捨五入）を表示するように変更

## v1.0.1 - 2025-08-05

### 機能改善
- iPhoneでテキストボックスをタップした際にズームするのを抑制

## v1.0.0 - 2025-08-05

### 機能改善
- フィルター機能を仕様書通りに修正
  - 適用ボタン押下時に、該当するファイルのみを一覧に表示するように変更
  - フィルター適用時、チェックボックスの選択を上位20件に制限
  - フィルター適用前に選択されていたチェックボックスをすべて解除するように修正
  - フィルター条件が空の場合は絞り込みを行わないように修正
  - クリアボタン押下時に、ファイル一覧の選択状態をすべてリセットするように修正

### 不具合修正
- `useGpx`フックで未定義の変数を参照していた問題を修正


## 2025-08-04 (v14)

### 追加 (Added)

-   標高グラフの表示モードを「標高」「標高差」「獲得標高」に切り替える機能を追加
    -   グラフの右下にあるトグルボタンで3つのモードを順に切り替えられるようにした

---

## 2025-08-04 (v13)

### 追加 (Added)

-   PC表示時に、標高グラフのサイズを「標準」「最大化」「最小化」に切り替えるトグルボタンを追加

### 変更 (Changed)

-   サイドバーでファイル名をクリックした際にも、その軌跡情報が常に表示されるように変更
-   PC表示のサイドバーの初期幅を調整

### 修正 (Fixed)

-   グラフのサイズ変更機能に起因する、レイアウトが崩れる、あるいは表示が乱れるといった問題を修正

---

## 2025-08-04 (v12)

### パフォーマンス (Performance)

-   フィルター処理を高速化
    -   フィルター適用時に全GPXデータを読み込むのではなく、メモリ上のデータとメタデータのみを読み込むように変更し、大幅に高速化した

---

## 2025-08-04 (v11)

### 修正 (Fixed)

-   初期表示時にレイアウトが正しく表示されない不具合を修正
    -   `Split.js`の初期化処理に起因する、コンテナが正しく幅を持たない問題を修正するため、CSSの`.split-vertical`に`flex-grow: 1`を追加した
-   モバイル表示のレイアウト調整を最適化
    -   幅の単位を`%`から`dvh`に変更
    -   不要な`height`指定を削除

---

## 2025-08-04 (v10)

### リファクタリング (Refactoring)

-   地図関連のロジックを`useMap.js`カスタムフックに移行
    -   `MapController`（操作機能）と`MapEvents`（地図イベント）を`Map.js`から`useMap.js`に移動し、コンポーネントの責務を分離した

### 修正 (Fixed)

-   リファクタリングに起因するいくつかの不具合を修正
    -   `App.js`での`useMap`フックのインポート漏れ
    -   `useMap.js`内での`useMap`フックの再帰呼び出し
    -   地図の初期化機能に起因する不要な再レンダリング

---

## 2025-08-04 (v9)

### 追加 (Added)

-   標高グラフと地図のインタラクション機能を追加
    -   グラフ上にマウスカーソルを合わせると、地図上にリアルタイムでマーカーを表示できるようにした

### 変更 (Changed)

-   グラフと地図の連動機能を、サイドバーでフォーカスされている軌跡のみを対象とするように変更

### 修正 (Fixed)

-   複数軌跡の表示時に、標高グラフのX軸が正しくない問題を修正
-   地図上に表示されるマーカーの描画が読み込まれない不具合を修正
-   グラフの初期化機能に起因する、コンポーネントの不要な再レンダリングを修正

---

## 2025-08-04 (v8)

### 追加 (Added)

-   地図のフォーカス機能を追加
    -   サイドバーでGPXファイル名をクリックした際に、該当の軌跡に地図がフォーカスして移動するようにした
    -   表示するGPXファイルが1つだけの場合も、自動的にフォーカスできるようにした
-   サイドバーにリセットボタンと削除ボタンを追加
    -   リセット: すべてのGPXトラックの選択を解除する
    -   削除: 選択されているGPXトラックを削除する

### 変更 (Changed)

-   フィルター機能を改善
    -   キーワード、日付範囲、地図の表示範囲での絞り込みに対応

### 更新 (Updated)

-   地図のフォーカス機能に関する記述を`design_doc.md`に追記

---

## 2025-07-31 (v7)

### 追加 (Added)

-   `IndexedDB`を利用したデータ永続化機能を追加
    -   アップロードしたGPXデータがブラウザを閉じても保持されるようにした
    -   `IndexedDB`を扱うための`idb`ライブラリを導入

### 変更 (Changed)

-   パフォーマンス最適化のため、データのオンデマンド読み込み方式を採用
    -   アプリ起動時は、座標データを含まない軽量なメタデータのみを読み込むように変更
    -   トラック表示時やフォーカス時に初めて`IndexedDB`から完全な座標データを読み込むように変更
-   不要な`useGpx.js`フックのデータ取得処理をリファクタリング

### 更新 (Updated)

-   オンデマンド読み込みに関する記述を`design_doc.md`に追記

### 修正 (Fixed)

-   オンデマンド読み込み実装後、UI情報表示に不具合があった問題を修正

---

## 2025-07-31 (v6)

### 追加 (Added)

-   GPXファイル一覧のフィルター機能を追加
    -   キーワードによるGPX名の絞り込み機能を追加
    -   フィルター条件を入力するためのモーダルウィンドウを追加

---

## 2025-07-31 (v5)

### 追加 (Added)

-   選択したGPXトラックの詳細情報を地図右上のオーバーレイに表示する機能を追加
    -   表示項目: 出発日時, 到着日時, 総距離, 獲得標高, 最高標高/最低標高
-   サイドバーのGPXファイル名クリックで、該当のトラックをフォーカスする機能を追加
-   フォーカスされたトラックをサイドバーでハイライト表示するようにした

### 変更 (Changed)
-   `gpxParser.js`で取得するトラックポイントの時刻を正しく修正
-   詳細情報の標高表示に3桁区切りのカンマを追加

### 更新 (Updated)

-   詳細情報表示の記述を`design_doc.md`に追記

---

## 2025-07-31 (v4)

### 追加 (Added)

-   サイドバーにチェックボックスを追加し、GPXトラックの表示/非表示を切り替える機能を追加

### 変更 (Changed)

-   サイドバーのファイル一覧の表示形式を「日時 GPX名」に変更

---

## 2025-07-31 (v3)

### 追加 (Added)

-   GPXデータに含まれる異常値（距離スパイク・標高スパイク）をフィルターする機能を追加

### 変更 (Changed)

-   標高グラフの横軸を、距離単位から**累積距離 (km)** に変更
-   標高グラフの横軸の目盛りを0.5km単位で表示するように調整

### 更新 (Updated)

-   異常値の変更内容を`design_doc.md`に追記

---

## 2025-07-31 (v2)

### 追加 (Added)

-   `react-leaflet`を導入し、地図表示機能を追加
    -   OpenStreetMap、国土地理院など複数のタイルレイヤーを切り替えられるようにした
    -   縮尺コントロールを表示
-   GPXファイルのアップロード機能を追加
    -   サイドバーに「アップロード」ボタンを設置
    -   複数ファイルの選択に対応
-   GPXファイルの解析機能を追加
    -   `DOMParser`を利用してGPX(XML)からトラックのデータなどを抽出する`gpxParser.js`を作成
-   アップロードしたGPXの軌跡を地図上にポリラインとして描画する機能を追加
-   アップロードしたファイルの情報をサイドバーに表示する機能を追加

### 変更 (Changed)

-   画面全体に表示されるタイトルを日本語に変更
-   `useGpx.js`フックで、ファイルの解析とデータ取得を担うように修正

### 修正 (Fixed)

-   `Sidebar.js`でpropsの受け渡しが間違っていた不具合を修正

---

## 2025-07-31 (v1)

### 追加 (Added)

-   Reactプロジェクトのひな形を作成
-   初期設定に必要なコンポーネントとカスタムフックのファイルを追加
    -   `App.js`, `Sidebar.js`, `FilterModal.js`, `GpxInfoOverlay.js`, `ElevationGraph.js`
    -   `hooks/useMap.js`, `hooks/useGpx.js`, `hooks/useUI.js`
-   `Split.js`を導入し、PC表示時に各ペインのサイズをドラッグで変更できるようにした
-   レスポンシブ対応を追加
    -   モバイル表示（幅768px以下）ではサイドバーをオーバーレイ表示に切り替え
    -   ハンバーガーメニューによるサイドバーの開閉機能を実装
-   Gitリポジトリを初期化し、`.gitignore`ファイルを作成
-   変更履歴を記録するための`CHANGES.md`を作成