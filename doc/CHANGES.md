# 変更履歴

## 2025-08-04 (v10)

### リファクタリング (Refactoring)

-   地図関連のロジックを`useMap.js`カスタムフックに集約
    -   `MapController`（自動ズーム機能）と`MapEvents`（地図イベント監視）を`Map.js`から`useMap.js`に移動し、コンポーネントの責務を分離した

### 修正 (Fixed)

-   リファクタリングに伴い発生した以下のバグを修正
    -   `App.js`での`useMap`フックのインポート漏れ
    -   `useMap.js`内での`useMap`フックの名前空間の衝突
    -   地図の自動ズーム機能に起因する無限再描画ループ

---

## 2025-08-04 (v9)

### 追加 (Added)

-   標高グラフと地図のインタラクティブな連携機能を追加
    -   グラフのホバー位置に追従して、地図上にリアルタイムでマーカーを表示するようにした

### 変更 (Changed)

-   グラフと地図の連携機能を、サイドバーでフォーカスされている軌跡のみを対象とするように改善

### 修正 (Fixed)

-   複数軌跡の表示時に、標高グラフのX軸が最も長いトラックの距離に合うように修正
-   地図上に表示されるマーカーの画像が読み込まれない問題を修正
-   グラフのホバー機能に起因する、コンポーネントの無限再描画ループのバグを修正

---

## 2025-08-04 (v8)

### 追加 (Added)

-   地図の自動ズーム機能を追加
    -   サイドバーでGPXファイル名をクリックした際に、該当の軌跡に地図が自動で移動・ズームするようにした
    -   表示するGPXファイルが1つだけの場合も、同様に自動でズームするようにした
-   サイドバーにリセットボタンと削除ボタンを追加
    -   リセット: すべてのGPXトラックの選択を解除する
    -   削除: 選択されているGPXトラックを削除する

### 変更 (Changed)

-   フィルター機能を強化
    -   キーワード、日付範囲、現在の地図表示範囲での絞り込みに対応

### 更新 (Updated)

-   地図の自動ズームに関する仕様を`design_doc.md`に反映

---

## 2025-07-31 (v7)

### 追加 (Added)

-   `IndexedDB`を使用したデータ永続化機能を追加
    -   アップロードしたGPXデータがブラウザリロード後も保持されるようにした
    -   `IndexedDB`を操作するための`idb`ライブラリを導入

### 変更 (Changed)

-   パフォーマンス向上のため、データのオンデマンド読み込み方式を導入
    -   アプリ起動時は座標を含まないメタデータのみを読み込むように変更
    -   トラック表示時やフォーカス時に初めて`IndexedDB`から完全な座標データを読み込むように変更
-   上記に伴い、`useGpx.js`フックのデータ管理ロジックを全面的にリファクタリング

### 更新 (Updated)

-   オンデマンド読み込みの設計を`design_doc.md`に反映

### 修正 (Fixed)

-   オンデマンド読み込み実装後の、詳細情報表示における不具合を修正

---

## 2025-07-31 (v6)

### 追加 (Added)

-   GPXファイル一覧のフィルター機能を追加
    -   キーワードによるGPX名の絞り込み機能を実装
    -   フィルター条件を設定するためのモーダルウィンドウを追加

---

## 2025-07-31 (v5)

### 追加 (Added)

-   選択したGPXトラックの詳細情報を地図右上のオーバーレイに表示する機能を追加
    -   表示項目: 出発日時, 到着日時, 総距離, 獲得標高, 最高/最低標高
-   サイドバーのファイル名クリックで、該当のトラックをフォーカスする機能を追加
-   フォーカスされたトラックをサイドバーでハイライト表示するようにした

### 変更 (Changed)
-   `gpxParser.js`で各トラックポイントの時刻も解析するように修正
-   詳細情報の標高表示に3桁区切りのカンマを追加

### 更新 (Updated)

-   詳細情報表示の仕様を`design_doc.md`に追記

---

## 2025-07-31 (v4)

### 追加 (Added)

-   サイドバーにチェックボックスを追加し、GPXトラックの表示/非表示を切り替える機能を追加

### 変更 (Changed)

-   サイドバーのファイル一覧の表示形式を「日付 GPX名」に変更

---

## 2025-07-31 (v3)

### 追加 (Added)

-   GPXデータに含まれる異常値（距離・標高のスパイク）をフィルタリングする機能を追加

### 変更 (Changed)

-   標高グラフの横軸を、ポイント数から**累積距離 (km)** に変更
-   標高グラフの横軸の目盛りを0.5km単位で表示するように調整

### 更新 (Updated)

-   上記の変更点を`design_doc.md`に反映

---

## 2025-07-31 (v2)

### 追加 (Added)

-   `react-leaflet`を導入し、地図表示機能を追加
    -   OpenStreetMap、国土地理院など複数のタイルレイヤーを切り替えられるようにした
    -   縮尺コントロールを表示
-   GPXファイルのアップロード機能を追加
    -   サイドバーに「アップロード」ボタンを設置
    -   複数ファイルの選択に対応
-   GPXファイルの解析機能を追加
    -   `DOMParser`を使用してGPX(XML)から軌跡の座標などを抽出する`gpxParser.js`を作成
-   アップロードされたGPXの軌跡を地図上にポリラインとして描画する機能を追加
-   アップロードされたファイルの一覧をサイドバーに表示する機能を追加

### 変更 (Changed)

-   画面に表示される文言を日本語に統一
-   `useGpx.js`フックで、ファイルの解析とデータ管理を行うように修正

### 修正 (Fixed)

-   `Sidebar.js`でpropsの受け取り方が間違っていた不具合を修正

---

## 2025-07-31 (v1)

### 追加 (Added)

-   Reactプロジェクトのひな形を作成
-   仕様書に基づき、以下のコンポーネントとカスタムフックのファイルを追加
    -   `App.js`, `Sidebar.js`, `FilterModal.js`, `GpxInfoOverlay.js`, `ElevationGraph.js`
    -   `hooks/useMap.js`, `hooks/useGpx.js`, `hooks/useUI.js`
-   `Split.js`を導入し、PC表示時に各エリアのサイズをドラッグで変更できるようにした
-   レスポンシブ対応を追加
    -   モバイル表示（幅768px以下）ではサイドバーをオーバーレイ表示に切り替え
    -   ハンバーガーメニューによるサイドバーの開閉機能を実装
-   Gitリポジトリを初期化し、`.gitignore`ファイルを作成
-   変更履歴を記録するための`CHANGES.md`を作成
